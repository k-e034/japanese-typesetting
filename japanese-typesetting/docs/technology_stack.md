# 日本語組版特化ソフトウェア 技術スタック詳細設計

## 1. 概要

本ドキュメントでは、日本語組版特化ソフトウェアの技術スタックについて詳細な設計と選定理由を記述します。JIS X 4051に準拠した高品質な日本語組版を実現するために、最適な技術の組み合わせを選定しました。

## 2. 基本技術スタック

### 2.1 プログラミング言語

**C++17**

選定理由:
- 高いパフォーマンスと低レベル制御が可能
- クロスプラットフォーム対応が容易
- モダンな言語機能（ラムダ式、スマートポインタ、並列処理など）の活用
- テキスト処理や組版処理に必要な細かい制御が可能
- 既存の組版・フォントレンダリングライブラリとの親和性

### 2.2 ビルドシステム

**CMake**

選定理由:
- クロスプラットフォームのビルド設定が容易
- 外部依存ライブラリの検出と統合が柔軟
- モジュール化されたプロジェクト構造の管理に適している
- CI/CD環境との連携が容易
- コミュニティサポートが充実

### 2.3 依存管理

**vcpkg**

選定理由:
- Microsoftが開発・維持している信頼性の高いパッケージマネージャ
- クロスプラットフォーム対応
- CMakeとの統合が容易
- 多数のライブラリに対応
- バージョン管理が容易

## 3. コア技術スタック

### 3.1 Unicode処理

**ICU (International Components for Unicode)**

選定理由:
- 包括的なUnicode対応
- 文字正規化、変換、照合などの高度な機能
- 多言語対応（将来の多言語拡張を見据えて）
- 業界標準として広く採用されている
- 継続的なメンテナンスとアップデート

### 3.2 フォント処理

**FreeType**

選定理由:
- 高品質なフォントレンダリング
- 多様なフォント形式（TrueType, OpenType, Type1など）のサポート
- 詳細なグリフ情報へのアクセスが可能
- クロスプラットフォーム対応
- オープンソースで広く採用されている

### 3.3 テキストシェーピング

**HarfBuzz**

選定理由:
- OpenTypeの高度な機能をサポート
- 複雑なスクリプト（日本語を含む）の適切なレンダリング
- FreeTypeとの統合が容易
- グリフの置換や位置調整などの高度な処理が可能
- 国際的なテキスト処理の標準ライブラリ

## 4. インターフェース技術スタック

### 4.1 GUI

**Qt5**

選定理由:
- クロスプラットフォームのGUIフレームワーク
- 高度なウィジェットとカスタマイズ機能
- 組版プレビューに必要なグラフィック機能
- イベント駆動型プログラミングモデル
- 広範なドキュメントとコミュニティサポート

### 4.2 コマンドライン

**標準C++ライブラリ + カスタム実装**

選定理由:
- 外部依存を最小限に抑える
- 柔軟なコマンドライン引数処理
- バッチ処理やスクリプト連携に適した設計
- 軽量で高速な実行

## 5. 出力技術スタック

### 5.1 PDF出力

**PoDoFo**

選定理由:
- C++で実装された軽量なPDFライブラリ
- 詳細なPDF構造の制御が可能
- 日本語フォント埋め込みのサポート
- クロスプラットフォーム対応
- アクティブに開発・メンテナンスされている

### 5.2 EPUB出力

**pugixml + カスタム実装**

選定理由:
- 軽量で高速なXML処理ライブラリ
- EPUBの構造化データ処理に適している
- メモリ効率が良い
- C++との親和性が高い
- カスタム実装との組み合わせで柔軟なEPUB生成が可能

### 5.3 HTML出力

**libxml2 + カスタム実装**

選定理由:
- 堅牢なXML/HTML処理ライブラリ
- DOM操作やXPath検索などの高度な機能
- 広く採用されている標準ライブラリ
- カスタムCSSとの連携が容易
- クロスプラットフォーム対応

## 6. テスト技術スタック

### 6.1 単体テスト

**Google Test**

選定理由:
- C++向けの包括的なテストフレームワーク
- 豊富なアサーション機能
- テストの構造化と管理が容易
- モックオブジェクトのサポート（Google Mock）
- CI/CDとの統合が容易

### 6.2 カバレッジ測定

**gcov + lcov**

選定理由:
- GCC組み込みのコードカバレッジツール
- 詳細なカバレッジレポートの生成
- CMakeとの統合が容易
- 視覚的なレポート出力
- 広く採用されている標準ツール

## 7. プラグインシステム

**動的ライブラリ + カスタムAPI**

選定理由:
- 柔軟な拡張性
- プラグインの動的ロードと管理
- クリーンなAPIインターフェース設計
- バージョン互換性の管理
- サードパーティ開発のサポート

## 8. バージョン管理とCI/CD

### 8.1 バージョン管理

**Git**

選定理由:
- 分散型バージョン管理システム
- ブランチモデルによる並行開発のサポート
- 広く採用されている業界標準
- 豊富なツールとの連携

### 8.2 CI/CD

**GitHub Actions**

選定理由:
- Gitリポジトリとの緊密な統合
- クロスプラットフォームビルドとテストの自動化
- カスタマイズ可能なワークフロー
- コンテナベースの実行環境
- 広範なコミュニティサポートとプラグイン

## 9. 技術スタックの統合アーキテクチャ

本ソフトウェアは、上記の技術スタックを以下のレイヤー構造で統合します：

1. **コアレイヤー**
   - Unicode処理（ICU）
   - フォント処理（FreeType）
   - テキストシェーピング（HarfBuzz）
   - 組版エンジン（カスタム実装）

2. **インターフェースレイヤー**
   - GUI（Qt5）
   - CLI（カスタム実装）

3. **出力レイヤー**
   - PDF出力（PoDoFo）
   - EPUB出力（pugixml + カスタム実装）
   - HTML出力（libxml2 + カスタム実装）

4. **拡張レイヤー**
   - プラグインシステム（動的ライブラリ + カスタムAPI）

各レイヤーは明確に分離され、依存関係は上位レイヤーから下位レイヤーへの一方向のみとします。これにより、モジュール性、テスト容易性、拡張性を確保します。

## 10. 今後の技術検討事項

1. **パフォーマンス最適化**
   - マルチスレッド処理の導入
   - メモリ使用量の最適化

2. **国際化対応**
   - 多言語インターフェース
   - 複数言語混在文書の対応

3. **アクセシビリティ**
   - スクリーンリーダー対応
   - アクセシブルなPDF出力

4. **クラウド連携**
   - オンラインストレージ統合
   - 共同編集機能

これらの検討事項は、コア機能の実装後に段階的に導入を検討します。
